<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>StudentHub</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,800;1,700&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&display=swap" rel="stylesheet"/>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOKENS & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --bg:#060709; --bg-card:rgba(18,20,28,.78); --bg-card-h:rgba(28,30,42,.9);
  --glass:rgba(255,255,255,.035); --glass-b:rgba(255,255,255,.07); --glass-b-h:rgba(255,255,255,.14);
  --accent:#6c63ff; --accent-mid:#8b84ff; --accent-l:#b8b4ff;
  --glow:rgba(108,99,255,.32); --glow-sm:rgba(108,99,255,.18);
  --text:#eceaf5; --text-s:#6e6d82; --text-t:#3f3f52;
  --red:#ff4d4d; --amber:#f5a623; --green:#34d399; --gold:#f5c842; --silver:#a8b2c1; --bronze:#cd7f32;
  --r-sm:10px; --r-md:16px; --r-lg:24px; --r-xl:32px;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:999;opacity:.035;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,.08);border-radius:99px}

/* â•â•â• AMBIENT â•â•â• */
.ambient{position:fixed;inset:0;z-index:0;pointer-events:none}
.blob{position:absolute;border-radius:50%;filter:blur(100px);opacity:.5;animation:drift 20s ease-in-out infinite alternate}
.blob--1{width:600px;height:600px;top:-20%;left:-15%;background:radial-gradient(circle,rgba(108,99,255,.2),transparent 70%)}
.blob--2{width:420px;height:420px;bottom:-12%;right:-10%;background:radial-gradient(circle,rgba(52,211,153,.11),transparent 70%);animation-delay:-7s}
.blob--3{width:320px;height:320px;top:45%;left:58%;background:radial-gradient(circle,rgba(245,166,35,.07),transparent 70%);animation-delay:-14s}
@keyframes drift{0%{transform:translate(0,0) scale(1)}100%{transform:translate(28px,-36px) scale(1.06)}}

/* â•â•â• SHARED ANIMATIONS â•â•â• */
@keyframes revUp{0%{opacity:0;transform:translateY(18px)}100%{opacity:1;transform:translateY(0)}}
@keyframes revDown{0%{opacity:0;transform:translateY(-18px)}100%{opacity:1;transform:translateY(0)}}
@keyframes popIn{0%{opacity:0;transform:scale(.65)}100%{opacity:1;transform:scale(1)}}
@keyframes taskSlide{0%{opacity:0;transform:translateY(14px) scale(.96)}100%{opacity:1;transform:translateY(0) scale(1)}}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.7)}}
@keyframes fireGlow{0%,100%{filter:drop-shadow(0 0 6px rgba(245,166,35,.6))}50%{filter:drop-shadow(0 0 14px rgba(245,166,35,.9))}}
@keyframes levelFlash{0%{opacity:0}15%{opacity:.35}40%{opacity:0}100%{opacity:0}}
@keyframes achieveSlideIn{0%{opacity:0;transform:translateY(40px) scale(.9)}40%{transform:translateY(-8px) scale(1.02)}100%{opacity:1;transform:translateY(0) scale(1)}}
@keyframes achieveGlow{0%,100%{box-shadow:0 0 20px rgba(245,200,66,.3)}50%{box-shadow:0 0 50px rgba(245,200,66,.6)}}
@keyframes spinOnce{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
@keyframes toastSlide{0%{opacity:0;transform:translateX(120%)}20%{opacity:1;transform:translateX(0)}80%{opacity:1;transform:translateX(0)}100%{opacity:0;transform:translateX(120%)}}
@keyframes xpFloat{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-60px) scale(.6)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.auth-screen{position:fixed;inset:0;z-index:100;display:flex;align-items:center;justify-content:center;padding:20px;background:var(--bg)}
.auth-screen .ambient{z-index:0}
.auth-box{position:relative;z-index:1;width:100%;max-width:420px;background:var(--bg-card);backdrop-filter:blur(28px);border:1px solid var(--glass-b);border-radius:var(--r-xl);padding:44px 36px 36px;animation:popIn .55s cubic-bezier(.22,1,.36,1) forwards}
.auth-box__logo{text-align:center;margin-bottom:30px}
.auth-box__logo .logo-icon{width:56px;height:56px;border-radius:18px;background:linear-gradient(135deg,var(--accent),#8b5cf6);display:flex;align-items:center;justify-content:center;font-size:26px;margin:0 auto 14px;box-shadow:0 4px 24px var(--glow)}
.auth-box__logo h1{font-family:'Playfair Display',serif;font-size:30px;font-weight:800;letter-spacing:-1.5px;background:linear-gradient(135deg,#fff 20%,var(--accent-l) 70%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.auth-box__logo p{color:var(--text-s);font-size:13px;margin-top:5px;font-weight:300}
.auth-tabs{display:flex;gap:5px;background:rgba(255,255,255,.04);border-radius:var(--r-md);padding:4px;margin-bottom:26px}
.auth-tab{flex:1;padding:10px;border:none;background:transparent;color:var(--text-s);font-family:'DM Sans',sans-serif;font-size:13px;font-weight:500;border-radius:var(--r-sm);cursor:pointer;transition:all .25s}
.auth-tab.active{background:var(--bg-card-h);color:var(--text);box-shadow:0 2px 12px rgba(0,0,0,.3)}
.auth-form{display:none;flex-direction:column;gap:13px}
.auth-form.visible{display:flex;animation:revUp .4s cubic-bezier(.22,1,.36,1) forwards}
.auth-form label{font-size:10px;font-weight:600;color:var(--text-s);text-transform:uppercase;letter-spacing:1.4px;margin-bottom:-7px}
.auth-form input{background:rgba(255,255,255,.05);border:1px solid var(--glass-b);border-radius:var(--r-md);padding:12px 15px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;transition:border-color .3s,box-shadow .3s}
.auth-form input:focus{border-color:rgba(108,99,255,.4);box-shadow:0 0 20px var(--glow-sm)}
.auth-form input::placeholder{color:var(--text-t)}
.auth-form .err{color:var(--red);font-size:11.5px;margin-top:-7px;min-height:15px;font-weight:500}
.btn-auth{width:100%;padding:13px;border:none;border-radius:var(--r-md);background:linear-gradient(135deg,var(--accent),#8b5cf6);color:#fff;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;margin-top:2px;position:relative;overflow:hidden;transition:transform .2s,box-shadow .2s;box-shadow:0 4px 24px var(--glow)}
.btn-auth::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.15),transparent);pointer-events:none}
.btn-auth:hover{transform:translateY(-1px);box-shadow:0 6px 32px var(--glow)}
.btn-auth:active{transform:scale(.97)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app{display:none;position:relative;z-index:1;min-height:100vh}
.app.visible{display:block}

/* â”€â”€â”€ TOPBAR â”€â”€â”€ */
.topbar{display:flex;align-items:center;justify-content:space-between;padding:16px 28px;position:sticky;top:0;z-index:10;background:rgba(6,7,9,.78);backdrop-filter:blur(22px);border-bottom:1px solid var(--glass-b)}
.topbar__left{display:flex;align-items:center;gap:11px}
.topbar__avatar{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#8b5cf6);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:#fff;box-shadow:0 2px 10px var(--glow);flex-shrink:0}
.topbar__name{font-size:13px;font-weight:600;color:var(--text)}
.topbar__right{display:flex;align-items:center;gap:10px}
.topbar__xp{display:flex;align-items:center;gap:5px;background:rgba(245,200,66,.1);border:1px solid rgba(245,200,66,.2);border-radius:99px;padding:5px 12px}
.topbar__xp span{font-size:11px;font-weight:600;color:var(--gold)}
.topbar__ach{display:flex;align-items:center;gap:5px;background:rgba(168,178,193,.08);border:1px solid rgba(168,178,193,.15);border-radius:99px;padding:5px 12px;cursor:pointer;transition:border-color .2s}
.topbar__ach:hover{border-color:rgba(168,178,193,.3)}
.topbar__ach span{font-size:11px;font-weight:600;color:var(--silver)}
.btn-logout{background:rgba(255,255,255,.05);border:1px solid var(--glass-b);color:var(--text-s);font-size:11px;font-family:'DM Sans',sans-serif;padding:6px 12px;border-radius:var(--r-sm);cursor:pointer;transition:all .2s}
.btn-logout:hover{border-color:rgba(255,77,77,.3);color:var(--red)}

/* â”€â”€â”€ PAGE â”€â”€â”€ */
.page{max-width:960px;margin:0 auto;padding:36px 28px 100px}

/* â”€â”€â”€ HEADER â”€â”€â”€ */
.header{margin-bottom:32px}
.header__top{display:flex;align-items:flex-end;justify-content:space-between;gap:18px;flex-wrap:wrap}
.header__title{font-family:'Playfair Display',serif;font-size:clamp(30px,6.5vw,48px);font-weight:800;letter-spacing:-2px;line-height:1.05}
.header__title .grad{background:linear-gradient(135deg,#fff 10%,var(--accent-l) 65%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.header__title .sub{display:block;font-style:italic;font-size:.5em;font-weight:700;letter-spacing:0;margin-top:4px;background:linear-gradient(135deg,var(--accent-mid),var(--accent-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.level-badge{display:flex;align-items:center;gap:10px;background:linear-gradient(135deg,rgba(245,200,66,.12),rgba(245,200,66,.04));border:1px solid rgba(245,200,66,.25);border-radius:var(--r-lg);padding:11px 16px;white-space:nowrap}
.level-badge__icon{font-size:20px}
.level-badge__info .lvl-label{font-size:9px;color:var(--gold);text-transform:uppercase;letter-spacing:1.4px;font-weight:600}
.level-badge__info .lvl-num{font-family:'Playfair Display',serif;font-size:18px;font-weight:700;color:var(--gold)}
.level-badge__xp-bar{width:90px;height:3px;background:rgba(255,255,255,.08);border-radius:99px;margin-top:5px;overflow:hidden}
.level-badge__xp-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--gold),#ffec80);transition:width .5s cubic-bezier(.22,1,.36,1)}

/* â”€â”€â”€ LAYOUT â”€â”€â”€ */
.layout{display:grid;grid-template-columns:1fr 280px;gap:22px;align-items:start}

/* â”€â”€â”€ STATS â”€â”€â”€ */
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:9px;margin-bottom:16px}
.stat{background:var(--bg-card);backdrop-filter:blur(16px);border:1px solid var(--glass-b);border-radius:var(--r-lg);padding:16px 8px;text-align:center;transition:border-color .3s,transform .25s;position:relative;overflow:hidden}
.stat::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--glow-sm),transparent);opacity:0;transition:opacity .4s}
.stat:hover{border-color:var(--glass-b-h);transform:translateY(-2px)}
.stat:hover::before{opacity:1}
.stat__num{font-family:'Playfair Display',serif;font-size:24px;font-weight:700;color:var(--accent-l);transition:transform .3s}
.stat__num--g{color:var(--green)!important}
.stat__num--a{color:var(--amber)!important}
.stat__label{font-size:8px;font-weight:600;color:var(--text-t);text-transform:uppercase;letter-spacing:1.4px;margin-top:3px}

/* â”€â”€â”€ PROGRESS â”€â”€â”€ */
.progress-wrap{margin-bottom:16px}
.progress-head{display:flex;justify-content:space-between;margin-bottom:7px}
.progress-head span{font-size:10px;font-weight:500;color:var(--text-s);text-transform:uppercase;letter-spacing:.8px}
.progress-head .pct{font-family:'Playfair Display',serif;font-weight:700;color:var(--accent-l);font-size:11px;text-transform:none;letter-spacing:0}
.progress-track{height:3px;background:rgba(255,255,255,.06);border-radius:99px;overflow:hidden}
.progress-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--accent),var(--accent-l));box-shadow:0 0 8px var(--glow-sm);transition:width .5s cubic-bezier(.22,1,.36,1)}

/* â”€â”€â”€ INPUT CARD â”€â”€â”€ */
.input-card{background:var(--bg-card);backdrop-filter:blur(24px);border:1px solid var(--glass-b);border-radius:var(--r-xl);padding:20px;margin-bottom:16px;transition:border-color .35s,box-shadow .35s}
.input-card:focus-within{border-color:rgba(108,99,255,.35);box-shadow:0 0 36px var(--glow-sm)}
.input-row{display:flex;align-items:center;gap:10px}
.input-row input{flex:1;background:transparent;border:none;outline:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;padding:7px 0;caret-color:var(--accent)}
.input-row input::placeholder{color:var(--text-t);transition:color .3s}
.input-row input:focus::placeholder{color:var(--text-s)}
.btn-add{width:42px;height:42px;border-radius:var(--r-md);border:none;background:linear-gradient(135deg,var(--accent),#8b5cf6);color:#fff;font-size:21px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 18px var(--glow);transition:transform .2s,box-shadow .2s;position:relative;overflow:hidden}
.btn-add::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.18),transparent);pointer-events:none}
.btn-add:hover{transform:scale(1.08);box-shadow:0 6px 26px var(--glow)}
.btn-add:active{transform:scale(.94)}
.opts{display:flex;flex-wrap:wrap;gap:6px;align-items:center;margin-top:14px;padding-top:14px;border-top:1px solid var(--glass-b)}
.opts__label{font-size:9px;font-weight:600;color:var(--text-t);text-transform:uppercase;letter-spacing:1.2px;margin-right:1px}
.pill{background:rgba(255,255,255,.04);border:1px solid var(--glass-b);color:var(--text-s);font-size:10.5px;font-weight:500;font-family:'DM Sans',sans-serif;padding:5px 12px;border-radius:99px;cursor:pointer;transition:all .2s;user-select:none}
.pill:hover{border-color:var(--glass-b-h);color:var(--text)}
.pill--active{background:var(--glow-sm);border-color:rgba(108,99,255,.35);color:var(--accent-l)}
.sel-pri{background:rgba(255,255,255,.04);border:1px solid var(--glass-b);color:var(--text-s);font-size:10.5px;font-weight:500;font-family:'DM Sans',sans-serif;padding:5px 9px;border-radius:99px;cursor:pointer;outline:none;-webkit-appearance:none;appearance:none;transition:border-color .2s}
.sel-pri:hover{border-color:var(--glass-b-h)}
.sel-pri option{background:#1a1a26;color:var(--text)}

/* â”€â”€â”€ FILTERS â”€â”€â”€ */
.filters{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px}
.filters .pill{font-size:10.5px;padding:5px 14px}

/* â”€â”€â”€ TASK LIST â”€â”€â”€ */
.task-list{display:flex;flex-direction:column;gap:8px}
.task{background:var(--bg-card);backdrop-filter:blur(16px);border:1px solid var(--glass-b);border-radius:var(--r-lg);padding:14px 16px;display:flex;align-items:center;gap:12px;transition:border-color .3s,background .3s,transform .25s;position:relative;overflow:hidden}
.task::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--accent);border-radius:0 99px 99px 0;opacity:0;transition:opacity .3s}
.task:hover{border-color:var(--glass-b-h);transform:translateX(5px)}
.task:hover::before{opacity:1}
.task--done{opacity:.3}
.task--done .task__text{text-decoration:line-through;color:var(--text-s)}
.task--animate{animation:taskSlide .35s cubic-bezier(.22,1,.36,1) forwards}
.task__check{width:22px;height:22px;border-radius:7px;border:2px solid var(--text-t);background:transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .22s cubic-bezier(.22,1,.36,1)}
.task__check:hover{border-color:var(--accent);box-shadow:0 0 8px var(--glow-sm)}
.task__check--on{background:linear-gradient(135deg,var(--accent),#8b5cf6);border-color:transparent;box-shadow:0 2px 12px var(--glow)}
.task__checkmark{color:#fff;font-size:11px;font-weight:700;opacity:0;transform:scale(.4) rotate(-20deg);transition:all .22s cubic-bezier(.22,1,.36,1)}
.task__check--on .task__checkmark{opacity:1;transform:scale(1) rotate(0)}
.task__body{flex:1;min-width:0}
.task__text{font-size:13px;font-weight:500;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:color .3s}
.task__meta{display:flex;align-items:center;gap:7px;margin-top:5px;flex-wrap:wrap}
.badge{font-size:8.5px;font-weight:600;text-transform:uppercase;letter-spacing:.9px;padding:2.5px 8px;border-radius:99px}
.badge--math{background:rgba(108,99,255,.14);color:var(--accent-l)}
.badge--english{background:rgba(52,211,153,.12);color:var(--green)}
.badge--science{background:rgba(245,166,35,.12);color:var(--amber)}
.badge--history{background:rgba(255,77,77,.12);color:var(--red)}
.badge--other{background:rgba(255,255,255,.06);color:var(--text-s)}
.prio{display:flex;align-items:center;gap:4px;font-size:8.5px;font-weight:500;color:var(--text-t);text-transform:uppercase;letter-spacing:.5px}
.prio__dot{width:5px;height:5px;border-radius:50%}
.prio__dot--high{background:var(--red);box-shadow:0 0 4px rgba(255,77,77,.5)}
.prio__dot--medium{background:var(--amber);box-shadow:0 0 4px rgba(245,166,35,.4)}
.prio__dot--low{background:var(--green);box-shadow:0 0 4px rgba(52,211,153,.4)}
.task__xp{font-size:8.5px;font-weight:600;color:var(--gold);margin-left:auto}
.task__del{background:none;border:none;color:var(--text-t);font-size:17px;cursor:pointer;padding:4px 6px;border-radius:var(--r-sm);transition:color .2s,background .2s;flex-shrink:0;opacity:.55}
.task__del:hover{color:var(--red);background:rgba(255,77,77,.1);opacity:1}

/* â”€â”€â”€ XP FLOAT â”€â”€â”€ */
.xp-float{position:fixed;font-size:14px;font-weight:700;color:var(--gold);pointer-events:none;z-index:50;animation:xpFloat .9s cubic-bezier(.22,1,.36,1) forwards;text-shadow:0 0 10px rgba(245,200,66,.5)}

/* â”€â”€â”€ EMPTY â”€â”€â”€ */
.empty{text-align:center;padding:48px 16px}
.empty__icon{width:58px;height:58px;border-radius:18px;background:var(--glass);border:1px solid var(--glass-b);display:flex;align-items:center;justify-content:center;font-size:24px;margin:0 auto 14px}
.empty__title{font-family:'Playfair Display',serif;font-size:17px;font-weight:700;margin-bottom:5px}
.empty__desc{color:var(--text-t);font-size:12.5px}

/* â”€â”€â”€ SIDEBAR â”€â”€â”€ */
.sidebar{display:flex;flex-direction:column;gap:12px}

/* Leaderboard */
.leaderboard{background:var(--bg-card);backdrop-filter:blur(20px);border:1px solid var(--glass-b);border-radius:var(--r-xl);padding:22px;position:relative;overflow:hidden}
.leaderboard::before{content:'';position:absolute;top:-35px;right:-35px;width:140px;height:140px;background:radial-gradient(circle,rgba(245,200,66,.08),transparent 70%);pointer-events:none}
.leaderboard__header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.leaderboard__header h3{font-family:'Playfair Display',serif;font-size:17px;font-weight:700}
.lb-list{display:flex;flex-direction:column;gap:5px}
.lb-row{display:flex;align-items:center;gap:10px;padding:8px 10px;border-radius:var(--r-md);transition:background .25s}
.lb-row:hover{background:rgba(255,255,255,.03)}
.lb-row--me{background:rgba(108,99,255,.08);border:1px solid rgba(108,99,255,.15)}
.lb-row--me .lb-name{color:var(--accent-l)}
.lb-rank{width:24px;text-align:center;font-family:'Playfair Display',serif;font-size:14px;font-weight:700;flex-shrink:0}
.lb-rank--1{color:var(--gold);text-shadow:0 0 8px rgba(245,200,66,.4)}
.lb-rank--2{color:var(--silver)}
.lb-rank--3{color:var(--bronze);text-shadow:0 0 6px rgba(205,127,50,.3)}
.lb-avatar{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;flex-shrink:0}
.lb-name{flex:1;font-size:12.5px;font-weight:500;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.lb-pts{font-size:11px;font-weight:600;color:var(--gold);flex-shrink:0}

/* Streak */
.streak-card{background:var(--bg-card);backdrop-filter:blur(16px);border:1px solid var(--glass-b);border-radius:var(--r-xl);padding:20px;text-align:center}
.streak-card__fire{font-size:32px;animation:fireGlow 1.8s ease infinite}
.streak-card__num{font-family:'Playfair Display',serif;font-size:28px;font-weight:700;color:var(--amber);margin-top:3px}
.streak-card__label{font-size:9px;color:var(--text-s);text-transform:uppercase;letter-spacing:1.4px;margin-top:3px;font-weight:500}

/* Achievements preview */
.ach-preview{background:var(--bg-card);backdrop-filter:blur(16px);border:1px solid var(--glass-b);border-radius:var(--r-xl);padding:20px}
.ach-preview h4{font-size:10px;font-weight:600;color:var(--text-s);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between}
.ach-preview h4 .see-all{color:var(--accent-l);font-size:10px;cursor:pointer;text-transform:none;letter-spacing:0;font-weight:500}
.ach-preview h4 .see-all:hover{text-decoration:underline}
.ach-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.ach-mini{width:100%;aspect-ratio:1;border-radius:10px;background:rgba(255,255,255,.04);border:1px solid var(--glass-b);display:flex;align-items:center;justify-content:center;font-size:16px;transition:transform .2s,border-color .2s;cursor:pointer;position:relative}
.ach-mini:hover{transform:scale(1.08);border-color:var(--glass-b-h)}
.ach-mini--locked{opacity:.25;filter:grayscale(1)}
.ach-mini--locked:hover{opacity:.4}

/* XP Guide */
.pts-info{background:var(--bg-card);backdrop-filter:blur(16px);border:1px solid var(--glass-b);border-radius:var(--r-xl);padding:18px}
.pts-info h4{font-size:9px;font-weight:600;color:var(--text-s);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:10px}
.pts-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid var(--glass-b);font-size:11px}
.pts-row:last-child{border-bottom:none}
.pts-row span:first-child{color:var(--text-s)}
.pts-row span:last-child{color:var(--gold);font-weight:600}

/* â•â•â• ACHIEVEMENT MODAL â•â•â• */
.ach-modal-overlay{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;padding:20px}
.ach-modal-overlay.visible{display:flex}
.ach-modal{background:var(--bg-card);backdrop-filter:blur(28px);border:1px solid var(--glass-b);border-radius:var(--r-xl);padding:32px;width:100%;max-width:520px;max-height:80vh;overflow-y:auto;position:relative;animation:popIn .4s cubic-bezier(.22,1,.36,1) forwards}
.ach-modal__close{position:absolute;top:16px;right:16px;background:none;border:none;color:var(--text-s);font-size:22px;cursor:pointer;transition:color .2s}
.ach-modal__close:hover{color:var(--text)}
.ach-modal h2{font-family:'Playfair Display',serif;font-size:22px;font-weight:700;margin-bottom:6px}
.ach-modal .subtitle{color:var(--text-s);font-size:12.5px;margin-bottom:22px}
.ach-modal .progress-summary{display:flex;align-items:center;gap:10px;margin-bottom:20px}
.ach-modal .progress-summary .count{font-family:'Playfair Display',serif;font-size:28px;font-weight:700;color:var(--gold)}
.ach-modal .progress-summary .count-label{font-size:11px;color:var(--text-s)}
.ach-full-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.ach-card{background:rgba(255,255,255,.03);border:1px solid var(--glass-b);border-radius:var(--r-lg);padding:16px;display:flex;align-items:center;gap:14px;transition:border-color .3s,background .3s}
.ach-card:hover{border-color:var(--glass-b-h);background:rgba(255,255,255,.05)}
.ach-card--unlocked{border-color:rgba(245,200,66,.25);background:rgba(245,200,66,.06)}
.ach-card__icon{width:42px;height:42px;border-radius:14px;background:rgba(255,255,255,.06);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.ach-card--unlocked .ach-card__icon{background:rgba(245,200,66,.12)}
.ach-card--locked{opacity:.35;filter:grayscale(1)}
.ach-card__info .ach-name{font-size:12.5px;font-weight:600;color:var(--text)}
.ach-card__info .ach-desc{font-size:10.5px;color:var(--text-s);margin-top:2px}
.ach-card--unlocked .ach-name{color:var(--gold)}

/* â•â•â• ACHIEVEMENT UNLOCK CELEBRATION â•â•â• */
.ach-celebrate{position:fixed;inset:0;z-index:300;display:none;align-items:center;justify-content:center;pointer-events:none}
.ach-celebrate.visible{display:flex}
.ach-celebrate__box{background:linear-gradient(135deg,rgba(18,20,28,.95),rgba(28,30,42,.95));border:1px solid rgba(245,200,66,.35);border-radius:var(--r-xl);padding:40px 44px;text-align:center;animation:achieveSlideIn .6s cubic-bezier(.22,1,.36,1) forwards;box-shadow:0 0 60px rgba(245,200,66,.2);max-width:340px;width:90%}
.ach-celebrate__icon{font-size:52px;animation:spinOnce .6s cubic-bezier(.22,1,.36,1) forwards;margin-bottom:12px}
.ach-celebrate__title{font-family:'Playfair Display',serif;font-size:22px;font-weight:800;color:var(--gold);margin-bottom:4px}
.ach-celebrate__name{font-size:18px;font-weight:600;color:var(--text);margin-bottom:6px}
.ach-celebrate__desc{font-size:12px;color:var(--text-s)}

/* â•â•â• LEVEL UP FLASH â•â•â• */
.level-flash{position:fixed;inset:0;z-index:250;pointer-events:none;background:linear-gradient(135deg,rgba(108,99,255,.4),rgba(139,92,246,.4));opacity:0;animation:levelFlash 1.2s ease forwards}

/* â•â•â• TOAST â•â•â• */
.toast-wrap{position:fixed;top:80px;right:24px;z-index:150;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.toast{background:var(--bg-card);backdrop-filter:blur(20px);border:1px solid var(--glass-b);border-radius:var(--r-lg);padding:12px 18px;display:flex;align-items:center;gap:10px;animation:toastSlide 3s cubic-bezier(.22,1,.36,1) forwards;pointer-events:none;max-width:300px}
.toast__icon{font-size:18px}
.toast__text{font-size:12.5px;font-weight:500;color:var(--text)}
.toast__text strong{color:var(--accent-l)}

/* â•â•â• CONFETTI â•â•â• */
.confetti-canvas{position:fixed;inset:0;z-index:998;pointer-events:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:740px){
  .layout{grid-template-columns:1fr}
  .sidebar{flex-direction:row;flex-wrap:wrap}
  .leaderboard{flex:1;min-width:180px}
  .streak-card{flex:0 0 auto}
  .ach-preview,.pts-info{flex:1;min-width:150px}
  .page{padding:28px 18px 100px}
  .topbar{padding:14px 18px}
  .ach-full-grid{grid-template-columns:1fr}
}
@media(max-width:480px){
  .topbar{padding:12px 14px;gap:8px}
  .topbar__name{font-size:12px}
  .topbar__xp span,.topbar__ach span{font-size:10px}
  .btn-logout{font-size:10px;padding:5px 9px}
  .page{padding:22px 12px 100px}
  .header__top{flex-direction:column;align-items:flex-start}
  .header__title{font-size:clamp(24px,7.5vw,34px)}
  .level-badge{padding:9px 12px}
  .stats{gap:6px}
  .stat{padding:13px 5px;border-radius:var(--r-md)}
  .stat__num{font-size:20px}
  .stat__label{font-size:7.5px}
  .input-card{padding:14px 12px;border-radius:var(--r-lg)}
  .btn-add{width:38px;height:38px;font-size:19px}
  .opts{margin-top:12px;padding-top:12px;gap:5px}
  .pill{font-size:10px;padding:4px 10px}
  .task{padding:12px 10px;gap:9px;border-radius:var(--r-md)}
  .task__text{font-size:12.5px}
  .task__del{font-size:15px}
  .sidebar{flex-direction:column}
  .auth-box{padding:32px 20px 26px}
  .auth-box__logo h1{font-size:24px}
  .auth-form input{padding:11px 13px;font-size:13px}
  .ach-modal{padding:24px 18px}
  .ach-full-grid{grid-template-columns:1fr}
  .toast-wrap{right:12px;top:70px}
  .toast{max-width:calc(100vw - 28px)}
}
</style>
</head>
<body>

<div class="ambient"><div class="blob blob--1"></div><div class="blob blob--2"></div><div class="blob blob--3"></div></div>
<canvas class="confetti-canvas" id="confettiCanvas"></canvas>
<div class="level-flash" id="levelFlash" style="display:none"></div>
<div class="toast-wrap" id="toastWrap"></div>

<!-- â•â•â• AUTH â•â•â• -->
<div class="auth-screen" id="authScreen">
  <div class="ambient"><div class="blob blob--1"></div><div class="blob blob--2"></div><div class="blob blob--3"></div></div>
  <div class="auth-box">
    <div class="auth-box__logo">
      <div class="logo-icon">ğŸ“š</div>
      <h1>StudentHub</h1>
      <p>Your premium study companion</p>
    </div>
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchTab('login')">Sign In</button>
      <button class="auth-tab" onclick="switchTab('signup')">Create Account</button>
    </div>
    <div class="auth-form visible" id="loginForm">
      <label>Username</label>
      <input type="text" id="loginUser" placeholder="Enter username" onkeydown="if(event.key==='Enter')doLogin()"/>
      <label>Password</label>
      <input type="password" id="loginPass" placeholder="Enter password" onkeydown="if(event.key==='Enter')doLogin()"/>
      <div class="err" id="loginErr"></div>
      <button class="btn-auth" onclick="doLogin()">Sign In</button>
    </div>
    <div class="auth-form" id="signupForm">
      <label>Username</label>
      <input type="text" id="signupUser" placeholder="Choose a username" onkeydown="if(event.key==='Enter')doSignup()"/>
      <label>Password</label>
      <input type="password" id="signupPass" placeholder="Create a password" onkeydown="if(event.key==='Enter')doSignup()"/>
      <label>Confirm Password</label>
      <input type="password" id="signupPass2" placeholder="Confirm password" onkeydown="if(event.key==='Enter')doSignup()"/>
      <div class="err" id="signupErr"></div>
      <button class="btn-auth" onclick="doSignup()">Create Account</button>
    </div>
  </div>
</div>

<!-- â•â•â• ACHIEVEMENT UNLOCK CELEBRATION â•â•â• -->
<div class="ach-celebrate" id="achCelebrate">
  <div class="ach-celebrate__box">
    <div class="ach-celebrate__icon" id="celebIcon">ğŸ†</div>
    <div class="ach-celebrate__title">Achievement Unlocked!</div>
    <div class="ach-celebrate__name" id="celebName">Name</div>
    <div class="ach-celebrate__desc" id="celebDesc">Description</div>
  </div>
</div>

<!-- â•â•â• ACHIEVEMENT MODAL â•â•â• -->
<div class="ach-modal-overlay" id="achModalOverlay" onclick="closeAchModal(event)">
  <div class="ach-modal">
    <button class="ach-modal__close" onclick="closeAchModal(null,true)">Ã—</button>
    <h2>Achievements</h2>
    <p class="subtitle">Unlock them all by completing tasks</p>
    <div class="progress-summary">
      <div class="count" id="achCount">0/12</div>
      <div class="count-label">Achievements<br>Unlocked</div>
    </div>
    <div class="ach-full-grid" id="achFullGrid"></div>
  </div>
</div>

<!-- â•â•â• APP â•â•â• -->
<div class="app" id="app">
  <div class="topbar">
    <div class="topbar__left">
      <div class="topbar__avatar" id="topAvatar">S</div>
      <div class="topbar__name" id="topName">Student</div>
    </div>
    <div class="topbar__right">
      <div class="topbar__xp"><span>â­ <span id="topXp">0</span> XP</span></div>
      <div class="topbar__ach" onclick="openAchModal()"><span>ğŸ† <span id="topAch">0</span>/12</span></div>
      <button class="btn-logout" onclick="doLogout()">Logout</button>
    </div>
  </div>

  <div class="page">
    <div class="header">
      <div class="header__top">
        <h1 class="header__title">
          <span class="grad">StudentHub</span>
          <span class="sub">Organize Â· Compete Â· Conquer</span>
        </h1>
        <div class="level-badge">
          <div class="level-badge__icon">ğŸ†</div>
          <div class="level-badge__info">
            <div class="lvl-label">Level</div>
            <div class="lvl-num" id="lvlNum">1</div>
            <div class="level-badge__xp-bar"><div class="level-badge__xp-fill" id="lvlBar" style="width:0%"></div></div>
          </div>
        </div>
      </div>
    </div>

    <div class="layout">
      <div class="left-col">
        <div class="stats">
          <div class="stat"><div class="stat__num" id="statTotal">0</div><div class="stat__label">Total</div></div>
          <div class="stat"><div class="stat__num stat__num--g" id="statDone">0</div><div class="stat__label">Done</div></div>
          <div class="stat"><div class="stat__num stat__num--a" id="statPending">0</div><div class="stat__label">Pending</div></div>
        </div>
        <div class="progress-wrap">
          <div class="progress-head"><span>Progress</span><span class="pct" id="progPct">0%</span></div>
          <div class="progress-track"><div class="progress-fill" id="progFill"></div></div>
        </div>
        <div class="input-card">
          <div class="input-row">
            <input type="text" id="taskInput" placeholder="What needs to be done?" onkeydown="if(event.key==='Enter')addTask()"/>
            <button class="btn-add" onclick="addTask()">+</button>
          </div>
          <div class="opts">
            <span class="opts__label">Subject</span>
            <button class="pill pill--active" data-tag="math" onclick="pickTag(this)">Math</button>
            <button class="pill" data-tag="english" onclick="pickTag(this)">English</button>
            <button class="pill" data-tag="science" onclick="pickTag(this)">Science</button>
            <button class="pill" data-tag="history" onclick="pickTag(this)">History</button>
            <button class="pill" data-tag="other" onclick="pickTag(this)">Other</button>
            <span class="opts__label" style="margin-left:3px">Priority</span>
            <select class="sel-pri" id="priSelect">
              <option value="medium">Medium</option>
              <option value="high">High ğŸ”¥</option>
              <option value="low">Low</option>
            </select>
          </div>
        </div>
        <div class="filters">
          <button class="pill pill--active" data-filter="all" onclick="pickFilter(this)">All</button>
          <button class="pill" data-filter="pending" onclick="pickFilter(this)">Pending</button>
          <button class="pill" data-filter="done" onclick="pickFilter(this)">Done</button>
          <button class="pill" data-filter="high" onclick="pickFilter(this)">ğŸ”¥ High</button>
        </div>
        <div class="task-list" id="taskList"></div>
      </div>

      <div class="sidebar">
        <div class="leaderboard">
          <div class="leaderboard__header"><h3>Leaderboard</h3><span>ğŸ‘‘</span></div>
          <div class="lb-list" id="lbList"></div>
        </div>
        <div class="streak-card">
          <div class="streak-card__fire">ğŸ”¥</div>
          <div class="streak-card__num" id="streakNum">0</div>
          <div class="streak-card__label">Day Streak</div>
        </div>
        <div class="ach-preview">
          <h4>Achievements <span class="see-all" onclick="openAchModal()">See All â†’</span></h4>
          <div class="ach-grid" id="achGrid"></div>
        </div>
        <div class="pts-info">
          <h4>How to Earn XP</h4>
          <div class="pts-row"><span>Complete a task</span><span>+10 XP</span></div>
          <div class="pts-row"><span>High priority task</span><span>+25 XP</span></div>
          <div class="pts-row"><span>Medium priority</span><span>+15 XP</span></div>
          <div class="pts-row"><span>Daily streak bonus</span><span>+5 XP</span></div>
          <div class="pts-row"><span>Unlock achievement</span><span>+50 XP</span></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACHIEVEMENTS DEFINITIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ACHIEVEMENTS = [
  { id:'first_task',      icon:'ğŸŒ±', name:'First Step',      desc:'Add your very first task',           check: u => u.tasks.length >= 1 },
  { id:'first_done',      icon:'âœ…', name:'Done Deal',       desc:'Complete your first task',          check: u => u.tasks.some(t=>t.done) },
  { id:'five_done',       icon:'ğŸš€', name:'On a Roll',       desc:'Complete 5 tasks',                  check: u => u.tasks.filter(t=>t.done).length >= 5 },
  { id:'ten_done',        icon:'ğŸ”¥', name:'On Fire',         desc:'Complete 10 tasks',                 check: u => u.tasks.filter(t=>t.done).length >= 10 },
  { id:'high_pri',        icon:'ğŸ’ª', name:'High Achiever',   desc:'Complete a high priority task',    check: u => u.tasks.some(t=>t.done && t.priority==='high') },
  { id:'all_subjects',    icon:'ğŸ“š', name:'Well Rounded',    desc:'Complete tasks in all 5 subjects', check: u => { const s=new Set(u.tasks.filter(t=>t.done).map(t=>t.tag)); return s.size>=5; }},
  { id:'streak_3',        icon:'ğŸ”¥', name:'Streak Master',   desc:'Reach a 3 day streak',             check: u => (u.streak||0) >= 3 },
  { id:'level_5',         icon:'â­', name:'Rising Star',     desc:'Reach Level 5',                    check: u => getLevel(u.xp) >= 5 },
  { id:'level_10',        icon:'ğŸŒŸ', name:'Star Player',     desc:'Reach Level 10',                   check: u => getLevel(u.xp) >= 10 },
  { id:'xp_500',          icon:'ğŸ’', name:'XP Hunter',       desc:'Earn 500 XP total',                check: u => (u.xp||0) >= 500 },
  { id:'math_master',     icon:'ğŸ§®', name:'Math Master',     desc:'Complete 3 Math tasks',            check: u => u.tasks.filter(t=>t.done&&t.tag==='math').length >= 3 },
  { id:'perfectionist',   icon:'ğŸ†', name:'Perfectionist',   desc:'Complete all your tasks',          check: u => u.tasks.length > 0 && u.tasks.every(t=>t.done) },
];

/* â•â•â• AUDIO ENGINE (Web Audio API) â•â•â• */
let audioCtx = null;
function getAudioCtx(){ if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); return audioCtx; }

function playSound(type){
  try {
    const ctx = getAudioCtx();
    if(ctx.state === 'suspended') ctx.resume();
    const now = ctx.currentTime;

    if(type === 'add'){
      // soft rising ping
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.type = 'sine'; o.frequency.setValueAtTime(440, now); o.frequency.exponentialRampToValueAtTime(880, now+0.15);
      g.gain.setValueAtTime(0.25, now); g.gain.exponentialRampToValueAtTime(0.001, now+0.4);
      o.connect(g); g.connect(ctx.destination); o.start(now); o.stop(now+0.4);
    }
    else if(type === 'complete'){
      // happy double ping
      [0, 0.12].forEach((delay, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.type = 'sine'; o.frequency.setValueAtTime(523, now+delay); o.frequency.exponentialRampToValueAtTime(783, now+delay+0.1);
        g.gain.setValueAtTime(0.22, now+delay); g.gain.exponentialRampToValueAtTime(0.001, now+delay+0.35);
        o.connect(g); g.connect(ctx.destination); o.start(now+delay); o.stop(now+delay+0.35);
      });
    }
    else if(type === 'delete'){
      // low thud
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.type = 'sine'; o.frequency.setValueAtTime(220, now); o.frequency.exponentialRampToValueAtTime(80, now+0.2);
      g.gain.setValueAtTime(0.18, now); g.gain.exponentialRampToValueAtTime(0.001, now+0.3);
      o.connect(g); g.connect(ctx.destination); o.start(now); o.stop(now+0.3);
    }
    else if(type === 'levelup'){
      // epic ascending arpeggio
      const notes = [523, 659, 784, 1047];
      notes.forEach((freq, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.type = 'sine'; o.frequency.setValueAtTime(freq, now + i*0.12);
        g.gain.setValueAtTime(0.2, now + i*0.12); g.gain.exponentialRampToValueAtTime(0.001, now + i*0.12 + 0.4);
        o.connect(g); g.connect(ctx.destination); o.start(now + i*0.12); o.stop(now + i*0.12 + 0.4);
      });
    }
    else if(type === 'achievement'){
      // magical shimmer
      const notes = [659, 784, 1047, 1319];
      notes.forEach((freq, i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.type = 'sine'; o.frequency.setValueAtTime(freq, now + i*0.1);
        g.gain.setValueAtTime(0.18, now + i*0.1); g.gain.exponentialRampToValueAtTime(0.001, now + i*0.1 + 0.5);
        o.connect(g); g.connect(ctx.destination); o.start(now + i*0.1); o.stop(now + i*0.1 + 0.5);
      });
    }
  } catch(e){}
}

/* â•â•â• STATE â•â•â• */
let DB={}, currentUser=null, tag='math', filter='all';

/* â•â•â• PERSISTENCE â•â•â• */
async function loadDB(){
  try{ const r=await window.storage.get('sh_users'); DB=r?JSON.parse(r.value):{}; }catch(e){ DB={}; }
  try{ const r2=await window.storage.get('sh_current'); if(r2&&r2.value&&DB[r2.value]){ currentUser=r2.value; showApp(); }}catch(e){}
}
async function saveDB(){
  try{ await window.storage.set('sh_users',JSON.stringify(DB)); }catch(e){}
  try{ await window.storage.set('sh_current',currentUser||''); }catch(e){}
}
function me(){ return DB[currentUser]; }

/* â•â•â• AUTH â•â•â• */
function switchTab(w){
  document.querySelectorAll('.auth-tab').forEach((t,i)=>t.classList.toggle('active',(w==='login'&&i===0)||(w==='signup'&&i===1)));
  document.getElementById('loginForm').classList.toggle('visible',w==='login');
  document.getElementById('signupForm').classList.toggle('visible',w==='signup');
  document.getElementById('loginErr').textContent='';
  document.getElementById('signupErr').textContent='';
}
window.switchTab=switchTab;

function doLogin(){
  const u=document.getElementById('loginUser').value.trim(), p=document.getElementById('loginPass').value, err=document.getElementById('loginErr');
  if(!u||!p) return err.textContent='Please fill in both fields.';
  if(!DB[u]) return err.textContent='Username not found.';
  if(DB[u].password!==p) return err.textContent='Incorrect password.';
  currentUser=u; saveDB(); showApp();
}
window.doLogin=doLogin;

function doSignup(){
  const u=document.getElementById('signupUser').value.trim(), p=document.getElementById('signupPass').value, p2=document.getElementById('signupPass2').value, err=document.getElementById('signupErr');
  if(!u||!p||!p2) return err.textContent='Fill in all fields.';
  if(u.length<3) return err.textContent='Username needs at least 3 characters.';
  if(p.length<4) return err.textContent='Password needs at least 4 characters.';
  if(p!==p2) return err.textContent='Passwords do not match.';
  if(DB[u]) return err.textContent='Username already taken.';
  DB[u]={password:p, xp:0, tasks:[], streak:0, lastActive:todayStr(), achievements:[]};
  currentUser=u; saveDB(); showApp();
}
window.doSignup=doSignup;

function doLogout(){
  currentUser=null; saveDB();
  document.getElementById('app').classList.remove('visible');
  document.getElementById('authScreen').style.display='flex';
  ['loginUser','loginPass','signupUser','signupPass','signupPass2'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('loginErr').textContent='';
  document.getElementById('signupErr').textContent='';
  switchTab('login');
}
window.doLogout=doLogout;

function showApp(){
  document.getElementById('authScreen').style.display='none';
  document.getElementById('app').classList.add('visible');
  const u=me();
  if(!u.achievements) u.achievements=[];
  checkStreak(); updateTopbar(); renderAll();
}

/* â•â•â• STREAK â•â•â• */
function todayStr(){ return new Date().toISOString().slice(0,10); }
function yesterdayStr(){ const d=new Date(); d.setDate(d.getDate()-1); return d.toISOString().slice(0,10); }
function checkStreak(){
  const u=me(); if(!u) return;
  const today=todayStr();
  if(u.lastActive===today) return;
  if(u.lastActive===yesterdayStr()){ u.streak=(u.streak||0)+1; u.xp=(u.xp||0)+5; }
  else { u.streak=1; }
  u.lastActive=today; saveDB();
}

/* â•â•â• TOPBAR â•â•â• */
function updateTopbar(){
  const u=me(); if(!u) return;
  document.getElementById('topName').textContent=currentUser;
  document.getElementById('topAvatar').textContent=currentUser[0].toUpperCase();
  document.getElementById('topXp').textContent=u.xp||0;
  document.getElementById('topAch').textContent=(u.achievements||[]).length;
}

/* â•â•â• LEVEL â•â•â• */
function getLevel(xp){ return Math.floor((xp||0)/100)+1; }
function getLevelProg(xp){ return (xp||0)%100; }

/* â•â•â• PICKERS â•â•â• */
function pickTag(btn){
  document.querySelectorAll('.opts .pill[data-tag]').forEach(b=>b.classList.remove('pill--active'));
  btn.classList.add('pill--active'); tag=btn.dataset.tag;
}
window.pickTag=pickTag;
function pickFilter(btn){
  document.querySelectorAll('.filters .pill').forEach(b=>b.classList.remove('pill--active'));
  btn.classList.add('pill--active'); filter=btn.dataset.filter; renderTasks();
}
window.pickFilter=pickFilter;

/* â•â•â• TASKS â•â•â• */
function addTask(){
  const input=document.getElementById('taskInput'), txt=input.value.trim();
  if(!txt) return;
  const pri=document.getElementById('priSelect').value;
  const xpVal=pri==='high'?25:pri==='medium'?15:10;
  me().tasks.unshift({id:Date.now(), text:txt, tag, priority:pri, done:false, xpVal});
  input.value=''; playSound('add'); saveDB(); checkAchievements(); renderAll(true);
}
window.addTask=addTask;

function toggleDone(id){
  const u=me(), t=u.tasks.find(x=>x.id===id); if(!t) return;
  const prevLevel = getLevel(u.xp);
  if(!t.done){
    t.done=true; u.xp=(u.xp||0)+t.xpVal; playSound('complete');
    saveDB(); updateTopbar();
    showXpFloat(t.xpVal);
    fireConfetti();
    const newLevel = getLevel(u.xp);
    if(newLevel > prevLevel) celebrateLevelUp(newLevel);
    checkAchievements();
  } else {
    t.done=false; u.xp=Math.max(0,(u.xp||0)-t.xpVal); playSound('delete'); saveDB(); updateTopbar();
  }
  renderAll();
}
window.toggleDone=toggleDone;

function deleteTask(id){
  const u=me(), t=u.tasks.find(x=>x.id===id);
  if(t&&t.done) u.xp=Math.max(0,(u.xp||0)-t.xpVal);
  u.tasks=u.tasks.filter(x=>x.id!==id); playSound('delete'); saveDB(); updateTopbar(); checkAchievements(); renderAll();
}
window.deleteTask=deleteTask;

/* â•â•â• XP FLOAT â•â•â• */
function showXpFloat(amount){
  const el=document.createElement('div');
  el.className='xp-float';
  el.textContent='+'+amount+' XP';
  el.style.left='50%'; el.style.top='45%'; el.style.transform='translateX(-50%)';
  document.body.appendChild(el);
  setTimeout(()=>el.remove(), 1000);
}

/* â•â•â• LEVEL UP â•â•â• */
function celebrateLevelUp(lvl){
  playSound('levelup');
  const flash=document.getElementById('levelFlash');
  flash.style.display='block'; flash.style.animation='none';
  void flash.offsetWidth;
  flash.style.animation='levelFlash 1.2s ease forwards';
  showToast('â¬†ï¸','You reached <strong>Level '+lvl+'</strong>!');
  setTimeout(()=>{ flash.style.display='none'; }, 1300);
}

/* â•â•â• ACHIEVEMENTS â•â•â• */
function checkAchievements(){
  const u=me(); if(!u) return;
  if(!u.achievements) u.achievements=[];
  ACHIEVEMENTS.forEach(a=>{
    if(!u.achievements.includes(a.id) && a.check(u)){
      u.achievements.push(a.id);
      u.xp=(u.xp||0)+50; // bonus XP
      saveDB(); updateTopbar();
      celebrateAchievement(a);
    }
  });
}

function celebrateAchievement(a){
  playSound('achievement');
  document.getElementById('celebIcon').textContent=a.icon;
  document.getElementById('celebName').textContent=a.name;
  document.getElementById('celebDesc').textContent=a.desc;
  const cel=document.getElementById('achCelebrate');
  cel.classList.add('visible');
  fireConfetti();
  showToast('ğŸ†','Achievement unlocked: <strong>'+a.name+'</strong>');
  setTimeout(()=>cel.classList.remove('visible'), 3200);
}

function openAchModal(){ document.getElementById('achModalOverlay').classList.add('visible'); renderAchModal(); }
window.openAchModal=openAchModal;
function closeAchModal(e, force){ if(force||e&&e.target===document.getElementById('achModalOverlay')) document.getElementById('achModalOverlay').classList.remove('visible'); }
window.closeAchModal=closeAchModal;

function renderAchModal(){
  const u=me(), unlocked=u.achievements||[];
  document.getElementById('achCount').textContent=unlocked.length+'/'+ACHIEVEMENTS.length;
  document.getElementById('achFullGrid').innerHTML=ACHIEVEMENTS.map(a=>{
    const locked=!unlocked.includes(a.id);
    return `<div class="ach-card ${locked?'ach-card--locked':'ach-card--unlocked'}">
      <div class="ach-card__icon">${a.icon}</div>
      <div class="ach-card__info">
        <div class="ach-name">${a.name}</div>
        <div class="ach-desc">${a.desc}</div>
      </div>
    </div>`;
  }).join('');
}

/* â•â•â• TOAST â•â•â• */
function showToast(icon, text){
  const wrap=document.getElementById('toastWrap');
  const toast=document.createElement('div');
  toast.className='toast';
  toast.innerHTML=`<div class="toast__icon">${icon}</div><div class="toast__text">${text}</div>`;
  wrap.appendChild(toast);
  setTimeout(()=>toast.remove(), 3100);
}

/* â•â•â• RENDER ALL â•â•â• */
function renderAll(fresh){
  renderTasks(fresh); renderStats(); renderLeaderboard(); renderStreak(); renderLevel(); renderAchPreview();
}
function renderTasks(fresh){
  const el=document.getElementById('taskList'), u=me(); if(!u) return;
  let list=u.tasks;
  if(filter==='pending') list=u.tasks.filter(t=>!t.done);
  if(filter==='done')    list=u.tasks.filter(t=>t.done);
  if(filter==='high')    list=u.tasks.filter(t=>t.priority==='high');
  if(!list.length){
    el.innerHTML=`<div class="empty"><div class="empty__icon">ğŸ“š</div><div class="empty__title">${filter==='all'?'No tasks yet':'Nothing here'}</div><div class="empty__desc">${filter==='all'?'Add your first task above!':'Try a different filter.'}</div></div>`;
    return;
  }
  el.innerHTML=list.map((t,i)=>`
    <div class="task ${t.done?'task--done':''} ${fresh&&i===0?'task--animate':''}">
      <div class="task__check ${t.done?'task__check--on':''}" onclick="toggleDone(${t.id})"><span class="task__checkmark">âœ“</span></div>
      <div class="task__body">
        <div class="task__text">${esc(t.text)}</div>
        <div class="task__meta">
          <span class="badge badge--${t.tag}">${t.tag}</span>
          <span class="prio"><span class="prio__dot prio__dot--${t.priority}"></span>${t.priority}</span>
          <span class="task__xp">â­ +${t.xpVal} XP</span>
        </div>
      </div>
      <button class="task__del" onclick="deleteTask(${t.id})">Ã—</button>
    </div>
  `).join('');
}
function renderStats(){
  const u=me(); if(!u) return;
  const total=u.tasks.length, done=u.tasks.filter(t=>t.done).length, pct=total?Math.round(done/total*100):0;
  document.getElementById('statTotal').textContent=total;
  document.getElementById('statDone').textContent=done;
  document.getElementById('statPending').textContent=total-done;
  document.getElementById('progPct').textContent=pct+'%';
  document.getElementById('progFill').style.width=pct+'%';
}
function renderLeaderboard(){
  const colors=['linear-gradient(135deg,#6c63ff,#8b5cf6)','linear-gradient(135deg,#34d399,#059669)','linear-gradient(135deg,#f5a623,#e67e22)','linear-gradient(135deg,#ff4d4d,#c0392b)','linear-gradient(135deg,#3b82f6,#2563eb)','linear-gradient(135deg,#a855f7,#7c3aed)','linear-gradient(135deg,#ec4899,#db2777)','linear-gradient(135deg,#14b8a6,#0d9488)'];
  const arr=Object.keys(DB).map(n=>({name:n,xp:DB[n].xp||0})).sort((a,b)=>b.xp-a.xp);
  const el=document.getElementById('lbList');
  if(!arr.length){ el.innerHTML='<div style="color:var(--text-t);font-size:12px;text-align:center;padding:14px">No players yet</div>'; return; }
  el.innerHTML=arr.map((u,i)=>{
    const r=i+1, icon=r===1?'ğŸ¥‡':r===2?'ğŸ¥ˆ':r===3?'ğŸ¥‰':r, rc=r<=3?`lb-rank--${r}`:'', isMe=u.name===currentUser;
    return `<div class="lb-row ${isMe?'lb-row--me':''}">
      <div class="lb-rank ${rc}">${icon}</div>
      <div class="lb-avatar" style="background:${colors[i%colors.length]}">${u.name[0].toUpperCase()}</div>
      <div class="lb-name">${esc(u.name)}${isMe?' (you)':''}</div>
      <div class="lb-pts">${u.xp} â­</div>
    </div>`;
  }).join('');
}
function renderStreak(){ const u=me(); if(u) document.getElementById('streakNum').textContent=u.streak||0; }
function renderLevel(){
  const u=me(); if(!u) return;
  document.getElementById('lvlNum').textContent=getLevel(u.xp);
  document.getElementById('lvlBar').style.width=getLevelProg(u.xp)+'%';
}
function renderAchPreview(){
  const u=me(); if(!u) return;
  const unlocked=u.achievements||[];
  document.getElementById('achGrid').innerHTML=ACHIEVEMENTS.map(a=>{
    const locked=!unlocked.includes(a.id);
    return `<div class="ach-mini ${locked?'ach-mini--locked':''}" onclick="openAchModal()" title="${a.name}">${a.icon}</div>`;
  }).join('');
}

/* â•â•â• CONFETTI â•â•â• */
function fireConfetti(){
  const canvas=document.getElementById('confettiCanvas'), ctx=canvas.getContext('2d');
  canvas.width=window.innerWidth; canvas.height=window.innerHeight;
  const colors=['#6c63ff','#34d399','#f5a623','#ff4d4d','#f5c842','#3b82f6','#ec4899','#a855f7'], pieces=[];
  for(let i=0;i<70;i++) pieces.push({
    x:canvas.width/2+(Math.random()-.5)*220, y:canvas.height*.42,
    vx:(Math.random()-.5)*15, vy:(Math.random()*-13)-4,
    life:1, color:colors[Math.floor(Math.random()*colors.length)],
    size:Math.random()*6+3, rot:Math.random()*Math.PI*2, rotV:(Math.random()-.5)*.32
  });
  (function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height); let alive=false;
    pieces.forEach(p=>{
      p.x+=p.vx; p.y+=p.vy; p.vy+=.19; p.life-=.019; p.rot+=p.rotV;
      if(p.life>0){ alive=true; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
        ctx.globalAlpha=p.life; ctx.fillStyle=p.color;
        ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*1.5); ctx.restore(); }
    });
    if(alive) requestAnimationFrame(loop); else ctx.clearRect(0,0,canvas.width,canvas.height);
  })();
}

function esc(s){ const d=document.createElement('div'); d.appendChild(document.createTextNode(s)); return d.innerHTML; }

/* â•â•â• INIT â•â•â• */
loadDB();
})();
</script>
</body>
</html>
